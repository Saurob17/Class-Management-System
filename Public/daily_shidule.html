<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dynamic Class Schedule</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:20px; }
    .container { max-width: 900px; margin: auto; background:white; padding:20px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
    .header { text-align:center; margin-bottom:20px; }
    .day-tabs { display:flex; gap:10px; margin-bottom:20px; overflow-x:auto; }
    .day-tab { flex:1; padding:10px; border:none; background:#eee; border-radius:5px; cursor:pointer; font-weight:bold; }
    .day-tab.active { background:#007bff; color:white; }
    .time-slot { padding:15px; margin-bottom:10px; background:#fafafa; border-left:5px solid #007bff; border-radius:8px; }
    .time { font-weight:bold; color:#007bff; }
    .subject { font-size:1.1rem; margin:5px 0; }
    .teacher { font-size:0.9rem; color:#555; }
    .room { font-size:0.8rem; background:#e3f2fd; color:#1976d2; padding:3px 8px; border-radius:12px; display:inline-block; margin-top:5px; }
    .error { color:red; text-align:center; margin:20px; }
    .no-classes { text-align:center; padding:30px; background:#ffe0b2; border-radius:10px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìö Dynamic Class Schedule</h1>
      <div id="currentDay">Loading...</div>
    </div>

    <!-- Session & Semester Selector -->
    <div style="margin-bottom:15px;">
      <label>Session: <input type="text" id="sessionInput" placeholder="e.g. 2023-24"></label>
      <label>Semester No: <input type="number" id="semInput" placeholder="e.g. 3"></label>
      <button onclick="saveSessionInfo()">Save</button>
    </div>

    <div class="day-tabs" id="dayTabs"></div>
    <div id="scheduleContainer">
      <p style="text-align:center;">Please select a day to view schedule</p>
    </div>
  </div>

  <script>
    const scheduleContainer = document.getElementById("scheduleContainer");
    const currentDayElem = document.getElementById("currentDay");
    const dayTabsElem = document.getElementById("dayTabs");

    const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const todayIndex = new Date().getDay();
    let selectedDay = days[todayIndex];

    // ===== Session Info in LocalStorage =====
    function getSessionInfo() {
      return {
        session: localStorage.getItem("session"),
        sem_No: localStorage.getItem("sem_No")
      };
    }

    function saveSessionInfo() {
      const session = document.getElementById("sessionInput").value.trim();
      const sem_No = document.getElementById("semInput").value.trim();

      if (!session || !sem_No) {
        alert("Please enter both session and semester number!");
        return;
      }
      localStorage.setItem("session", session);
      localStorage.setItem("sem_No", sem_No);
      alert("‚úÖ Session info saved!");
      loadScheduleData(selectedDay);
    }

    function initSessionInfo() {
      if (!localStorage.getItem("session")) {
        localStorage.setItem("session", "2023-24"); // default
      }
      if (!localStorage.getItem("sem_No")) {
        localStorage.setItem("sem_No", "3"); // default
      }
      document.getElementById("sessionInput").value = localStorage.getItem("session");
      document.getElementById("semInput").value = localStorage.getItem("sem_No");
    }

    // ===== Render Tabs =====
    function renderDayTabs() {
      dayTabsElem.innerHTML = "";
      days.forEach(day => {
        const btn = document.createElement("button");
        btn.className = "day-tab" + (day === selectedDay ? " active" : "");
        btn.textContent = day;
        btn.onclick = () => {
          selectedDay = day;
          document.querySelectorAll(".day-tab").forEach(tab => tab.classList.remove("active"));
          btn.classList.add("active");
          loadScheduleData(day);
        };
        dayTabsElem.appendChild(btn);
      });
    }

    // ===== Load Schedule =====
    function loadScheduleData(day) {
      const { session, sem_No } = getSessionInfo();

      if (!session || !sem_No) {
        scheduleContainer.innerHTML = `<div class="error">‚ö†Ô∏è Please set your session and semester.</div>`;
        return;
      }

      currentDayElem.textContent = day;
      scheduleContainer.innerHTML = `<p style="text-align:center;">Loading schedule...</p>`;

      fetch(`http://localhost:5000/api/daily_schedule?day=${encodeURIComponent(day)}&session=${encodeURIComponent(session)}&sem_No=${encodeURIComponent(sem_No)}`)
        .then(res => res.json())
        .then(data => {
          if (!data.success) {
            scheduleContainer.innerHTML = `<div class="error">${data.message}</div>`;
            return;
          }

          if (data.schedule.length === 0) {
            scheduleContainer.innerHTML = `<div class="no-classes">No classes today üéâ</div>`;
            return;
          }

          scheduleContainer.innerHTML = "";
          data.schedule.forEach(item => {
            const div = document.createElement("div");
            div.className = "time-slot";
            div.innerHTML = `
              <div class="time">${item.Start_Time} - ${item.End_Time}</div>
              <div class="subject">${item.Course_Code}</div>
              <div class="teacher">${item.Teacher_Short_Name}</div>
              <div class="room">${item.Class_Room}</div>
            `;
            scheduleContainer.appendChild(div);
          });
        })
        .catch(err => {
          console.error(err);
          scheduleContainer.innerHTML = `<div class="error">Failed to load schedule.</div>`;
        });
    }

    // ===== Initialize =====
    initSessionInfo();
    renderDayTabs();
    loadScheduleData(selectedDay);
  </script>
</body>
</html>
